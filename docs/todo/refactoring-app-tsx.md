# App.tsx リファクタリングタスクリスト

## 概要
App.tsxが肥大化しているため、責任の分離と保守性向上を目的としたリファクタリングを実施する。

## タスクリスト

### 1. 型定義の整備
- [x] `types/controller.ts` を作成し、コントローラー関連の型定義を追加
- [x] `types/websocket.ts` を作成し、WebSocketメッセージの型定義を追加
- [x] `types/gamepad.ts` を作成し、ゲームパッド関連の型定義を追加
- [x] `recievedStatus` の `any` 型を具体的な型に変更

### 2. 定数の外部化
- [x] `constants/app.ts` を作成
  - [x] WebSocketポート番号（2356）を定数化
  - [x] 自動検出間隔（100ms）を定数化
  - [x] デフォルトIPアドレス（127.0.0.1）を定数化
- [x] `constants/styles.ts` を作成し、スタイル定義を外部化

### 3. カスタムフックの作成
- [x] `hooks/useWebSocket.ts` を作成
  - [x] WebSocket接続ロジックを移動
  - [x] 接続状態管理を実装
  - [x] メッセージ送受信機能を実装
- [x] `hooks/useGamepadDetection.ts` を作成
  - [x] ゲームパッド自動検出ロジックを移動
  - [x] ゲームパッドプラグインのロード処理を移動
- [x] `hooks/useTauriWindow.ts` を作成
  - [x] Tauriウィンドウ関連の処理を移動
  - [x] `isTauriAvailable` 関数を移動
- [x] `hooks/useAppMode.ts` を作成
  - [x] サーバーモード/クライアントモード管理を実装

### 4. コンポーネントの分割
- [x] `components/AppHeader.tsx` を作成
  - [x] ヘッダー部分を抽出
  - [x] タイトル、リロードボタン、クローズボタンを含む
- [x] `components/GamepadSelector.tsx` を作成
  - [x] "コントローラーのボタンを押してください" メッセージを移動
  - [x] 自動検出状態の表示を実装
- [x] `components/ConnectionSettings.tsx` を作成
  - [x] IPアドレス入力フィールドを移動
  - [x] 受信モードボタンを移動
- [x] `components/ControllerDisplay.tsx` を作成
  - [x] `IIDXController` と `BeatStatus` の表示ロジックを統合

### 5. メインコンポーネントのリファクタリング
- [x] `App.tsx` を簡潔化
  - [x] カスタムフックを使用して状態管理を簡素化
  - [x] コンポーネントの組み合わせに専念
  - [x] 200行以上から94行に削減（約50%削減）

### 6. エラーハンドリングとパフォーマンス最適化
- [x] WebSocket接続エラーのユーザーフレンドリーな表示を追加
- [x] ゲームパッド検出エラーの適切なハンドリングを実装
- [x] WebSocketメッセージ送信の最適化（条件付き送信）
- [x] 不要な再レンダリングの防止（React.memo, useCallback の活用）

### 7. コードクオリティの改善
- [x] `recieved` → `received` のスペルミス修正（破壊的変更注意）
- [x] 適切なコメントの追加
- [x] console.log のデバッグ出力を開発環境のみに制限
- [ ] ESLintルールに準拠したコード整形

### 8. テストとドキュメント
- [ ] 各カスタムフックの使用例をコメントで記載
- [ ] コンポーネントのprops仕様をコメントで記載
- [ ] リファクタリング後の動作確認チェックリストを作成

## 実施順序の推奨
1. 型定義の整備（破壊的変更なし）
2. 定数の外部化（破壊的変更なし）
3. カスタムフックの作成（段階的に移行）
4. コンポーネントの分割（UIに影響なし）
5. メインコンポーネントのリファクタリング
6. エラーハンドリングとパフォーマンス最適化
7. コードクオリティの改善
8. テストとドキュメント

## 注意事項
- WebSocket通信の互換性を維持すること
- 既存の機能を壊さないよう、段階的にリファクタリングを実施
- 各ステップで動作確認を行うこと